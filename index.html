<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnimeHub - Powered by Jikan API Proxy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-indigo-700 text-white shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-tv text-2xl"></i>
                <h1 class="text-2xl font-bold">AnimeHub</h1>
            </div>
            <div class="flex items-center space-x-6">
                <a href="#" class="hover:text-indigo-200 transition-colors" id="nav-seasonal">Seasonal</a>
                <a href="#" class="hover:text-indigo-200 transition-colors" id="nav-top">Top Anime</a>
                <a href="#" class="hover:text-indigo-200 transition-colors" id="nav-upcoming">Upcoming</a>
                <div class="relative">
                    <input id="search-input" type="text" placeholder="Search anime..." 
                        class="px-3 py-1 rounded-full text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-400 w-48">
                    <button id="search-button" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="bg-indigo-600 text-white py-12">
        <div class="container mx-auto px-4 text-center">
            <h2 class="text-4xl font-bold mb-4">Discover Anime with AnimeHub</h2>
            <p class="text-xl mb-8">Powered by high-performance Jikan API Proxy</p>
            <div class="flex justify-center space-x-4">
                <button id="random-anime-btn" class="bg-white text-indigo-700 px-5 py-2 rounded-full font-semibold hover:bg-indigo-100 transition-colors">
                    <i class="fas fa-random mr-2"></i> Random Anime
                </button>
                <button id="current-season-btn" class="bg-indigo-800 px-5 py-2 rounded-full font-semibold hover:bg-indigo-900 transition-colors">
                    <i class="fas fa-calendar-alt mr-2"></i> Current Season
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Banner -->
    <div class="bg-white shadow-md py-4 mb-6">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center" id="stats-container">
                <div class="text-center">
                    <p class="text-gray-500">Cache Hit Ratio</p>
                    <p class="text-xl font-bold" id="cache-ratio">--</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-500">Avg Response Time</p>
                    <p class="text-xl font-bold" id="avg-response">--</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-500">Cache Size</p>
                    <p class="text-xl font-bold" id="cache-size">--</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-500">Uptime</p>
                    <p class="text-xl font-bold" id="uptime">--</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Page Title and Filters -->
    <div class="container mx-auto px-4 mb-6">
        <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold text-gray-800" id="content-title">Trending Now</h2>
            <div class="flex space-x-3">
                <select id="filter-type" class="rounded border p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400">
                    <option value="tv">TV</option>
                    <option value="movie">Movie</option>
                    <option value="ova">OVA</option>
                    <option value="special">Special</option>
                    <option value="all" selected>All Types</option>
                </select>
                <select id="filter-sort" class="rounded border p-2 focus:outline-none focus:ring-2 focus:ring-indigo-400">
                    <option value="score" selected>Score</option>
                    <option value="popularity">Popularity</option>
                    <option value="rank">Rank</option>
                    <option value="title">Title</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loading" class="container mx-auto px-4 text-center py-12 hidden">
        <div class="inline-block loading-spinner w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full"></div>
        <p class="text-lg text-gray-600 mt-4">Loading anime data...</p>
    </div>

    <!-- Anime Content -->
    <div class="container mx-auto px-4 pb-12">
        <div id="anime-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            <!-- Cards will be inserted here dynamically -->
        </div>
    </div>

    <!-- Pagination -->
    <div class="container mx-auto px-4 pb-12 flex justify-center">
        <div class="flex space-x-2" id="pagination">
            <button class="pagination-btn bg-white border border-indigo-300 text-indigo-600 px-4 py-2 rounded disabled:opacity-50" id="prev-page" disabled>
                <i class="fas fa-chevron-left mr-1"></i> Prev
            </button>
            <div id="page-numbers" class="flex space-x-2">
                <!-- Page numbers will be inserted here -->
            </div>
            <button class="pagination-btn bg-white border border-indigo-300 text-indigo-600 px-4 py-2 rounded" id="next-page">
                Next <i class="fas fa-chevron-right ml-1"></i>
            </button>
        </div>
    </div>

    <!-- Anime Detail Modal -->
    <div id="anime-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="relative">
                <button id="close-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
                <div id="modal-content" class="p-6">
                    <!-- Modal content will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-indigo-700 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-tv text-xl"></i>
                        <h3 class="text-xl font-bold">AnimeHub</h3>
                    </div>
                    <p class="mt-2">Powered by Jikan API Proxy</p>
                </div>
                <div class="flex space-x-6">
                    <a href="#" class="hover:text-indigo-200 transition-colors">
                        <i class="fab fa-github text-2xl"></i>
                    </a>
                    <a href="#" class="hover:text-indigo-200 transition-colors">
                        <i class="fab fa-twitter text-2xl"></i>
                    </a>
                    <a href="#" class="hover:text-indigo-200 transition-colors">
                        <i class="fas fa-code text-2xl"></i>
                    </a>
                </div>
            </div>
            <div class="mt-8 text-center text-indigo-200">
                <p>AnimeHub is not affiliated with MyAnimeList. This website uses the Jikan API.</p>
                <p class="mt-2">&copy; 2025 AnimeHub. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Configuration
        const API_BASE_URL = 'https://jikan-api-proxy.vercel.app'; // Change to your actual API URL
        let currentPage = 1;
        let totalPages = 1;
        let currentSection = 'seasonal';
        let currentQuery = '';
        let animeData = [];

        // DOM Elements
        const animeGrid = document.getElementById('anime-grid');
        const loadingIndicator = document.getElementById('loading');
        const contentTitle = document.getElementById('content-title');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const pageNumbers = document.getElementById('page-numbers');
        const animeModal = document.getElementById('anime-modal');
        const modalContent = document.getElementById('modal-content');
        const closeModal = document.getElementById('close-modal');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const randomAnimeBtn = document.getElementById('random-anime-btn');
        const currentSeasonBtn = document.getElementById('current-season-btn');
        const filterType = document.getElementById('filter-type');
        const filterSort = document.getElementById('filter-sort');
        const navSeasonal = document.getElementById('nav-seasonal');
        const navTop = document.getElementById('nav-top');
        const navUpcoming = document.getElementById('nav-upcoming');

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadCurrentSeason();

            // Navigation
            navSeasonal.addEventListener('click', (e) => {
                e.preventDefault();
                loadCurrentSeason();
            });

            navTop.addEventListener('click', (e) => {
                e.preventDefault();
                loadTopAnime();
            });

            navUpcoming.addEventListener('click', (e) => {
                e.preventDefault();
                loadUpcomingAnime();
            });

            // Buttons
            randomAnimeBtn.addEventListener('click', loadRandomAnime);
            currentSeasonBtn.addEventListener('click', loadCurrentSeason);
            searchButton.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });

            // Pagination
            prevPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    loadContent();
                }
            });

            nextPageBtn.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    loadContent();
                }
            });

            // Filters
            filterType.addEventListener('change', () => loadContent());
            filterSort.addEventListener('change', () => loadContent());

            // Modal
            closeModal.addEventListener('click', () => {
                animeModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            });

            // Close modal when clicking outside
            animeModal.addEventListener('click', (e) => {
                if (e.target === animeModal) {
                    animeModal.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                }
            });
        });

        // Load Stats
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE_URL}/stats`);
                const data = await response.json();
                
                document.getElementById('cache-ratio').textContent = data.cacheRatio;
                document.getElementById('avg-response').textContent = data.averageResponseTime;
                document.getElementById('cache-size').textContent = data.cacheSize;
                document.getElementById('uptime').textContent = data.uptime;
                
                // Refresh stats every minute
                setTimeout(loadStats, 60000);
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load Content based on current section
        function loadContent() {
            switch (currentSection) {
                case 'seasonal':
                    loadCurrentSeason();
                    break;
                case 'top':
                    loadTopAnime();
                    break;
                case 'upcoming':
                    loadUpcomingAnime();
                    break;
                case 'search':
                    performSearch(currentQuery);
                    break;
                default:
                    loadCurrentSeason();
            }
        }

        // Load Current Season Anime
        async function loadCurrentSeason() {
            currentSection = 'seasonal';
            contentTitle.textContent = 'Current Season Anime';
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/seasons?now=true&page=${currentPage}`);
                const data = await response.json();
                
                if (data && data.data) {
                    animeData = data.data;
                    totalPages = data.pagination?.last_visible_page || 1;
                    renderAnimeGrid(filterAnimeData(animeData));
                    updatePagination();
                }
            } catch (error) {
                console.error('Error loading current season:', error);
                animeGrid.innerHTML = `<div class="col-span-full text-center py-8">
                    <p class="text-red-500 text-lg">Error loading anime data. Please try again later.</p>
                </div>`;
            } finally {
                hideLoading();
            }
        }

        // Load Top Anime
        async function loadTopAnime() {
            currentSection = 'top';
            contentTitle.textContent = 'Top Anime';
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/top?type=anime&page=${currentPage}`);
                const data = await response.json();
                
                if (data && data.data) {
                    animeData = data.data;
                    totalPages = data.pagination?.last_visible_page || 1;
                    renderAnimeGrid(filterAnimeData(animeData));
                    updatePagination();
                }
            } catch (error) {
                console.error('Error loading top anime:', error);
                animeGrid.innerHTML = `<div class="col-span-full text-center py-8">
                    <p class="text-red-500 text-lg">Error loading anime data. Please try again later.</p>
                </div>`;
            } finally {
                hideLoading();
            }
        }

        // Load Upcoming Anime
        async function loadUpcomingAnime() {
            currentSection = 'upcoming';
            contentTitle.textContent = 'Upcoming Anime';
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/anime?status=upcoming&order_by=members&sort=desc&page=${currentPage}`);
                const data = await response.json();
                
                if (data && data.data) {
                    animeData = data.data;
                    totalPages = data.pagination?.last_visible_page || 1;
                    renderAnimeGrid(filterAnimeData(animeData));
                    updatePagination();
                }
            } catch (error) {
                console.error('Error loading upcoming anime:', error);
                animeGrid.innerHTML = `<div class="col-span-full text-center py-8">
                    <p class="text-red-500 text-lg">Error loading anime data. Please try again later.</p>
                </div>`;
            } finally {
                hideLoading();
            }
        }

        // Load Random Anime
        async function loadRandomAnime() {
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/random?type=anime`);
                const data = await response.json();
                
                if (data && data.data) {
                    showAnimeDetails(data.data);
                }
            } catch (error) {
                console.error('Error loading random anime:', error);
                alert('Error loading random anime. Please try again.');
            } finally {
                hideLoading();
            }
        }

        // Perform Search
        async function performSearch() {
            const query = searchInput.value.trim();
            if (!query) return;
            
            currentQuery = query;
            currentSection = 'search';
            contentTitle.textContent = `Search Results: "${query}"`;
            currentPage = 1;
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/anime?q=${encodeURIComponent(query)}&page=${currentPage}`);
                const data = await response.json();
                
                if (data && data.data) {
                    animeData = data.data;
                    totalPages = data.pagination?.last_visible_page || 1;
                    renderAnimeGrid(filterAnimeData(animeData));
                    updatePagination();
                }
            } catch (error) {
                console.error('Error searching anime:', error);
                animeGrid.innerHTML = `<div class="col-span-full text-center py-8">
                    <p class="text-red-500 text-lg">Error searching anime. Please try again later.</p>
                </div>`;
            } finally {
                hideLoading();
            }
        }

        // Show Anime Details
        async function showAnimeDetails(anime) {
            // If we only have basic info, fetch full details
            if (!anime.synopsis || !anime.background) {
                try {
                    const response = await fetch(`${API_BASE_URL}/anime?id=${anime.mal_id}`);
                    const data = await response.json();
                    if (data && data.data) {
                        anime = data.data;
                    }
                } catch (error) {
                    console.error('Error fetching anime details:', error);
                }
            }
            
            const studios = anime.studios?.map(studio => studio.name).join(', ') || 'Unknown';
            const genres = anime.genres?.map(genre => genre.name).join(', ') || 'Unknown';
            
            modalContent.innerHTML = `
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="w-full md:w-1/3">
                        <img src="${anime.images?.jpg?.large_image_url || anime.images?.jpg?.image_url}" 
                            alt="${anime.title}" class="w-full h-auto rounded-lg shadow-lg">
                        
                        <div class="mt-4 space-y-2">
                            <div class="flex items-center">
                                <span class="text-yellow-500"><i class="fas fa-star mr-2"></i></span>
                                <span class="font-bold text-lg">${anime.score || 'N/A'}</span>
                                <span class="text-gray-500 ml-2">(${anime.scored_by ? (anime.scored_by).toLocaleString() : 'N/A'} votes)</span>
                            </div>
                            
                            <div class="flex items-center">
                                <span class="text-gray-600"><i class="fas fa-list mr-2"></i></span>
                                <span>Ranked #${anime.rank || 'N/A'}</span>
                            </div>
                            
                            <div class="flex items-center">
                                <span class="text-gray-600"><i class="fas fa-heart mr-2"></i></span>
                                <span>Popularity #${anime.popularity || 'N/A'}</span>
                            </div>
                            
                            <div class="flex items-center">
                                <span class="text-gray-600"><i class="fas fa-users mr-2"></i></span>
                                <span>${anime.members ? (anime.members).toLocaleString() : 'N/A'} members</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="w-full md:w-2/3">
                        <h2 class="text-2xl font-bold mb-2">${anime.title}</h2>
                        <h3 class="text-gray-600 mb-4">${anime.title_japanese || ''}</h3>
                        
                        <div class="grid grid-cols-2 gap-x-4 gap-y-2 mb-4">
                            <div>
                                <span class="text-gray-600">Type:</span>
                                <span>${anime.type || 'Unknown'}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Episodes:</span>
                                <span>${anime.episodes || 'Unknown'}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Status:</span>
                                <span>${anime.status || 'Unknown'}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Aired:</span>
                                <span>${anime.aired?.string || 'Unknown'}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Studios:</span>
                                <span>${studios}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Genres:</span>
                                <span>${genres}</span>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-bold text-lg mb-2">Synopsis</h4>
                            <p class="text-gray-700">${anime.synopsis || 'No synopsis available.'}</p>
                        </div>
                        
                        ${anime.background ? `
                        <div>
                            <h4 class="font-bold text-lg mb-2">Background</h4>
                            <p class="text-gray-700">${anime.background}</p>
                        </div>
                        ` : ''}
                        
                        <div class="mt-6">
                            <a href="${anime.url}" target="_blank" class="inline-block bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition-colors">
                                <i class="fas fa-external-link-alt mr-2"></i>View on MyAnimeList
                            </a>
                        </div>
                    </div>
                </div>
            `;
            
            animeModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // Filter Anime Data
        function filterAnimeData(data) {
            const typeFilter = filterType.value;
            const sortFilter = filterSort.value;
            
            // Filter by type
            let filtered = data;
            if (typeFilter !== 'all') {
                filtered = data.filter(anime => anime.type?.toLowerCase() === typeFilter);
            }
            
            // Sort data
            filtered.sort((a, b) => {
                switch (sortFilter) {
                    case 'score':
                        return (b.score || 0) - (a.score || 0);
                    case 'popularity':
                        return (a.popularity || 999999) - (b.popularity || 999999);
                    case 'rank':
                        return (a.rank || 999999) - (b.rank || 999999);
                    case 'title':
                        return (a.title || '').localeCompare(b.title || '');
                    default:
                        return 0;
                }
            });
            
            return filtered;
        }

        // Render Anime Grid
        function renderAnimeGrid(animeList) {
            if (!animeList || animeList.length === 0) {
                animeGrid.innerHTML = `<div class="col-span-full text-center py-8">
                    <p class="text-gray-500 text-lg">No anime found matching your criteria.</p>
                </div>`;
                return;
            }
            
            animeGrid.innerHTML = animeList.map(anime => {
                const score = anime.score ? `<span class="text-yellow-500 font-bold">${anime.score}</span>` : 'N/A';
                
                return `
                <div class="bg-white rounded-lg shadow-md overflow-hidden card-hover transition-all duration-300" data-id="${anime.mal_id}">
                    <div class="relative h-64 overflow-hidden">
                        <img src="${anime.images?.jpg?.large_image_url || anime.images?.jpg?.image_url}" 
                            alt="${anime.title}" class="w-full h-full object-cover">
                        <div class="absolute top-0 right-0 bg-indigo-600 text-white text-sm px-2 py-1 rounded-bl-lg">
                            ${anime.type || 'Unknown'}
                        </div>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-3">
                            <h3 class="text-white font-bold text-sm truncate">${anime.title}</h3>
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-600">${anime.status || 'Unknown'}</span>
                            <div class="flex items-center">
                                <i class="fas fa-star text-yellow-500 mr-1"></i>
                                <span>${score}</span>
                            </div>
                        </div>
                        <div class="text-xs text-gray-500 mb-3">
                            ${anime.aired?.string || 'Unknown'}
                        </div>
                        <p class="text-sm text-gray-700 line-clamp-3 h-12 overflow-hidden">
                            ${anime.synopsis || 'No synopsis available.'}
                        </p>
                        <button class="w-full mt-3 bg-indigo-500 text-white py-1 rounded hover:bg-indigo-600 transition-colors view-details">
                            View Details
                        </button>
                    </div>
                </div>
                `;
            }).join('');
            
            // Add event listeners to anime cards
            document.querySelectorAll('.view-details').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const card = e.target.closest('[data-id]');
                    const animeId = card.getAttribute('data-id');
                    const anime = animeData.find(a => a.mal_id.toString() === animeId);
                    if (anime) {
                        showAnimeDetails(anime);
                    }
                });
            });
        }

        // Update Pagination
        function updatePagination() {
            prevPageBtn.disabled = currentPage <= 1;
            nextPageBtn.disabled = currentPage >= totalPages;
            
            // Generate page numbers
            pageNumbers.innerHTML = '';
            
            // Determine range of pages to show
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);
            
            // Always show first page
            if (startPage > 1) {
                addPageButton(1);
                if (startPage > 2) {
                    pageNumbers.innerHTML += '<span class="px-3 py-2">...</span>';
                }
            }
            
            // Add page numbers
            for (let i = startPage; i <= endPage; i++) {
                addPageButton(i);
            }
            
            // Always show last page
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pageNumbers.innerHTML += '<span class="px-3 py-2">...</span>';
                }
                addPageButton(totalPages);
            }
        }

        // Add Page Button
        function addPageButton(pageNum) {
            const pageBtn = document.createElement('button');
            pageBtn.classList.add('w-10', 'h-10', 'rounded', 'flex', 'items-center', 'justify-center');
            
            if (pageNum === currentPage) {
                pageBtn.classList.add('bg-indigo-600', 'text-white');
            } else {
                pageBtn.classList.add('bg-white', 'border', 'border-indigo-300', 'text-indigo-600');
            }
            
            pageBtn.textContent = pageNum;
            pageBtn.addEventListener('click', () => {
                currentPage = pageNum;
                loadContent();
            });
            
            pageNumbers.appendChild(pageBtn);
        }

        // Show Loading
        function showLoading() {
            loadingIndicator.classList.remove('hidden');
            animeGrid.classList.add('hidden');
        }

        // Hide Loading
        function hideLoading() {
            loadingIndicator.classList.add('hidden');
            animeGrid.classList.remove('hidden');
        }
    </script>
</body>
</html>
